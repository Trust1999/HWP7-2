#include <iostream>
#include <string>
#include <SerialStream.h> // Beispiel: libserial-dev unter Linux installieren

using namespace LibSerial;

int main() {
    SerialStream arduino;

    // Serielle Schnittstelle öffnen
    arduino.Open("/dev/ttyUSB0"); // Pfad anpassen
    arduino.SetBaudRate(SerialStreamBuf::BAUD_9600);
    arduino.SetCharSize(SerialStreamBuf::CHAR_SIZE_8);

    if (!arduino.IsOpen()) {
        std::cerr << "Fehler: Kann serielle Schnittstelle nicht öffnen!" << std::endl;
        return 1;
    }

    std::cout << "Verbindung hergestellt. Lesen und Schreiben starten..." << std::endl;

    while (true) {
        // Daten vom Arduino lesen
        std::string inputStates;
        std::getline(arduino, inputStates);

        if (!inputStates.empty()) {
            std::cout << "Arduino Eingänge: " << inputStates << std::endl;
        }

        // Daten an Arduino senden
        std::string outputStates = "1010"; // Beispiel: Muster zum Testen
        arduino << outputStates << "\n"; // Schreiben und abschicken

        usleep(500000); // Warte 500 ms
    }

    arduino.Close();
    return 0;
}
